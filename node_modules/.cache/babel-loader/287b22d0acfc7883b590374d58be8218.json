{"ast":null,"code":"import TransportWebUsb from '@ledgerhq/hw-transport-webusb';\nimport { getPublicKey, solana_derivation_path, solana_ledger_sign_bytes, solana_ledger_sign_transaction, solana_ledger_confirm_public_key } from './ledger-core';\nimport { DERIVATION_PATH } from './localStorage';\nimport bs58 from 'bs58';\nexport class LedgerWalletProvider {\n  constructor(args) {\n    this.init = async () => {\n      this.transport = await TransportWebUsb.create();\n      this.pubKey = await getPublicKey(this.transport, this.solanaDerivationPath);\n      this.transport.on('disconnect', this.onDisconnect);\n\n      this.listAddresses = async walletCount => {\n        // TODO: read accounts from ledger\n        return [this.pubKey];\n      };\n\n      return this;\n    };\n\n    this.signTransaction = async transaction => {\n      const sig_bytes = await solana_ledger_sign_transaction(this.transport, this.solanaDerivationPath, transaction);\n      transaction.addSignature(this.publicKey, sig_bytes);\n      return transaction;\n    };\n\n    this.createSignature = async message => {\n      const sig_bytes = await solana_ledger_sign_bytes(this.transport, this.solanaDerivationPath, message);\n      return bs58.encode(sig_bytes);\n    };\n\n    this.confirmPublicKey = async () => {\n      return await solana_ledger_confirm_public_key(this.transport, this.solanaDerivationPath);\n    };\n\n    this.onDisconnect = args && args.onDisconnect || (() => {});\n\n    this.derivationPath = args ? args.derivationPath : DERIVATION_PATH.bip44Change;\n    this.account = args ? args.account : undefined;\n    this.change = args ? args.change : undefined;\n    this.solanaDerivationPath = solana_derivation_path(this.account, this.change, this.derivationPath);\n  }\n\n  get publicKey() {\n    return this.pubKey;\n  }\n\n}","map":{"version":3,"sources":["/Users/onyejivictor/Documents/code/cope/bulk-spl-token-dist/src/utils/walletProvider/ledger.js"],"names":["TransportWebUsb","getPublicKey","solana_derivation_path","solana_ledger_sign_bytes","solana_ledger_sign_transaction","solana_ledger_confirm_public_key","DERIVATION_PATH","bs58","LedgerWalletProvider","constructor","args","init","transport","create","pubKey","solanaDerivationPath","on","onDisconnect","listAddresses","walletCount","signTransaction","transaction","sig_bytes","addSignature","publicKey","createSignature","message","encode","confirmPublicKey","derivationPath","bip44Change","account","undefined","change"],"mappings":"AAAA,OAAOA,eAAP,MAA4B,+BAA5B;AACA,SACEC,YADF,EAEEC,sBAFF,EAGEC,wBAHF,EAIEC,8BAJF,EAKEC,gCALF,QAMO,eANP;AAOA,SAASC,eAAT,QAAgC,gBAAhC;AACA,OAAOC,IAAP,MAAiB,MAAjB;AAEA,OAAO,MAAMC,oBAAN,CAA2B;AAChCC,EAAAA,WAAW,CAACC,IAAD,EAAO;AAAA,SAclBC,IAdkB,GAcX,YAAY;AACjB,WAAKC,SAAL,GAAiB,MAAMZ,eAAe,CAACa,MAAhB,EAAvB;AACA,WAAKC,MAAL,GAAc,MAAMb,YAAY,CAAC,KAAKW,SAAN,EAAiB,KAAKG,oBAAtB,CAAhC;AACA,WAAKH,SAAL,CAAeI,EAAf,CAAkB,YAAlB,EAAgC,KAAKC,YAArC;;AACA,WAAKC,aAAL,GAAqB,MAAOC,WAAP,IAAuB;AAC1C;AACA,eAAO,CAAC,KAAKL,MAAN,CAAP;AACD,OAHD;;AAIA,aAAO,IAAP;AACD,KAvBiB;;AAAA,SA6BlBM,eA7BkB,GA6BA,MAAOC,WAAP,IAAuB;AACvC,YAAMC,SAAS,GAAG,MAAMlB,8BAA8B,CACpD,KAAKQ,SAD+C,EAEpD,KAAKG,oBAF+C,EAGpDM,WAHoD,CAAtD;AAKAA,MAAAA,WAAW,CAACE,YAAZ,CAAyB,KAAKC,SAA9B,EAAyCF,SAAzC;AACA,aAAOD,WAAP;AACD,KArCiB;;AAAA,SAuClBI,eAvCkB,GAuCA,MAAOC,OAAP,IAAmB;AACnC,YAAMJ,SAAS,GAAG,MAAMnB,wBAAwB,CAC9C,KAAKS,SADyC,EAE9C,KAAKG,oBAFyC,EAG9CW,OAH8C,CAAhD;AAKA,aAAOnB,IAAI,CAACoB,MAAL,CAAYL,SAAZ,CAAP;AACD,KA9CiB;;AAAA,SAgDlBM,gBAhDkB,GAgDC,YAAY;AAC7B,aAAO,MAAMvB,gCAAgC,CAC3C,KAAKO,SADsC,EAE3C,KAAKG,oBAFsC,CAA7C;AAID,KArDiB;;AAChB,SAAKE,YAAL,GAAqBP,IAAI,IAAIA,IAAI,CAACO,YAAd,KAAgC,MAAM,CAAE,CAAxC,CAApB;;AACA,SAAKY,cAAL,GAAsBnB,IAAI,GACtBA,IAAI,CAACmB,cADiB,GAEtBvB,eAAe,CAACwB,WAFpB;AAGA,SAAKC,OAAL,GAAerB,IAAI,GAAGA,IAAI,CAACqB,OAAR,GAAkBC,SAArC;AACA,SAAKC,MAAL,GAAcvB,IAAI,GAAGA,IAAI,CAACuB,MAAR,GAAiBD,SAAnC;AACA,SAAKjB,oBAAL,GAA4Bb,sBAAsB,CAChD,KAAK6B,OAD2C,EAEhD,KAAKE,MAF2C,EAGhD,KAAKJ,cAH2C,CAAlD;AAKD;;AAaY,MAATL,SAAS,GAAG;AACd,WAAO,KAAKV,MAAZ;AACD;;AA5B+B","sourcesContent":["import TransportWebUsb from '@ledgerhq/hw-transport-webusb';\nimport {\n  getPublicKey,\n  solana_derivation_path,\n  solana_ledger_sign_bytes,\n  solana_ledger_sign_transaction,\n  solana_ledger_confirm_public_key,\n} from './ledger-core';\nimport { DERIVATION_PATH } from './localStorage';\nimport bs58 from 'bs58';\n\nexport class LedgerWalletProvider {\n  constructor(args) {\n    this.onDisconnect = (args && args.onDisconnect) || (() => {});\n    this.derivationPath = args\n      ? args.derivationPath\n      : DERIVATION_PATH.bip44Change;\n    this.account = args ? args.account : undefined;\n    this.change = args ? args.change : undefined;\n    this.solanaDerivationPath = solana_derivation_path(\n      this.account,\n      this.change,\n      this.derivationPath,\n    );\n  }\n\n  init = async () => {\n    this.transport = await TransportWebUsb.create();\n    this.pubKey = await getPublicKey(this.transport, this.solanaDerivationPath);\n    this.transport.on('disconnect', this.onDisconnect);\n    this.listAddresses = async (walletCount) => {\n      // TODO: read accounts from ledger\n      return [this.pubKey];\n    };\n    return this;\n  };\n\n  get publicKey() {\n    return this.pubKey;\n  }\n\n  signTransaction = async (transaction) => {\n    const sig_bytes = await solana_ledger_sign_transaction(\n      this.transport,\n      this.solanaDerivationPath,\n      transaction,\n    );\n    transaction.addSignature(this.publicKey, sig_bytes);\n    return transaction;\n  };\n\n  createSignature = async (message) => {\n    const sig_bytes = await solana_ledger_sign_bytes(\n      this.transport,\n      this.solanaDerivationPath,\n      message,\n    );\n    return bs58.encode(sig_bytes);\n  };\n\n  confirmPublicKey = async () => {\n    return await solana_ledger_confirm_public_key(\n      this.transport,\n      this.solanaDerivationPath,\n    );\n  };\n}\n"]},"metadata":{},"sourceType":"module"}