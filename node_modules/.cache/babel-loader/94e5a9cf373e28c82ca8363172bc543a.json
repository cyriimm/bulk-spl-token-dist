{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || Object.assign || function (t) {\n  for (var s, i = 1, n = arguments.length; i < n; i++) {\n    s = arguments[i];\n\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n  }\n\n  return t;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar http = require(\"http\");\n\nvar https = require(\"https\");\n\nvar os = require(\"os\");\n\nvar url = require(\"url\");\n\nvar progress_event_1 = require(\"./progress-event\");\n\nvar errors_1 = require(\"./errors\");\n\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\n\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\n\nvar Cookie = require(\"cookiejar\");\n\nvar XMLHttpRequest =\n/** @class */\nfunction (_super) {\n  __extends(XMLHttpRequest, _super);\n\n  function XMLHttpRequest(options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _this = _super.call(this) || this;\n\n    _this.UNSENT = XMLHttpRequest.UNSENT;\n    _this.OPENED = XMLHttpRequest.OPENED;\n    _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n    _this.LOADING = XMLHttpRequest.LOADING;\n    _this.DONE = XMLHttpRequest.DONE;\n    _this.onreadystatechange = null;\n    _this.readyState = XMLHttpRequest.UNSENT;\n    _this.response = null;\n    _this.responseText = '';\n    _this.responseType = '';\n    _this.status = 0; // TODO: UNSENT?\n\n    _this.statusText = '';\n    _this.timeout = 0;\n    _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n    _this.responseUrl = '';\n    _this.withCredentials = false;\n    _this._method = null;\n    _this._url = null;\n    _this._sync = false;\n    _this._headers = {};\n    _this._loweredHeaders = {};\n    _this._mimeOverride = null; // TODO: is type right?\n\n    _this._request = null;\n    _this._response = null;\n    _this._responseParts = null;\n    _this._responseHeaders = null;\n    _this._aborting = null; // TODO: type?\n\n    _this._error = null; // TODO: type?\n\n    _this._loadedBytes = 0;\n    _this._totalBytes = 0;\n    _this._lengthComputable = false;\n    _this._restrictedMethods = {\n      CONNECT: true,\n      TRACE: true,\n      TRACK: true\n    };\n    _this._restrictedHeaders = {\n      'accept-charset': true,\n      'accept-encoding': true,\n      'access-control-request-headers': true,\n      'access-control-request-method': true,\n      connection: true,\n      'content-length': true,\n      cookie: true,\n      cookie2: true,\n      date: true,\n      dnt: true,\n      expect: true,\n      host: true,\n      'keep-alive': true,\n      origin: true,\n      referer: true,\n      te: true,\n      trailer: true,\n      'transfer-encoding': true,\n      upgrade: true,\n      'user-agent': true,\n      via: true\n    };\n    _this._privateHeaders = {\n      'set-cookie': true,\n      'set-cookie2': true\n    };\n    _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n    _this._anonymous = options.anon || false;\n    return _this;\n  }\n\n  XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n    if (async === void 0) {\n      async = true;\n    }\n\n    method = method.toUpperCase();\n\n    if (this._restrictedMethods[method]) {\n      throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n    }\n\n    ;\n\n    var xhrUrl = this._parseUrl(url, user, password);\n\n    if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {// TODO(pwnall): terminate abort(), terminate send()\n    }\n\n    this._method = method;\n    this._url = xhrUrl;\n    this._sync = !async;\n    this._headers = {};\n    this._loweredHeaders = {};\n    this._mimeOverride = null;\n\n    this._setReadyState(XMLHttpRequest.OPENED);\n\n    this._request = null;\n    this._response = null;\n    this.status = 0;\n    this.statusText = '';\n    this._responseParts = [];\n    this._responseHeaders = null;\n    this._loadedBytes = 0;\n    this._totalBytes = 0;\n    this._lengthComputable = false;\n  };\n\n  XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n\n    var loweredName = name.toLowerCase();\n\n    if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n      console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n      return;\n    }\n\n    value = value.toString();\n\n    if (this._loweredHeaders[loweredName] != null) {\n      name = this._loweredHeaders[loweredName];\n      this._headers[name] = this._headers[name] + \", \" + value;\n    } else {\n      this._loweredHeaders[loweredName] = name;\n      this._headers[name] = value;\n    }\n  };\n\n  XMLHttpRequest.prototype.send = function (data) {\n    if (this.readyState !== XMLHttpRequest.OPENED) {\n      throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n    }\n\n    if (this._request) {\n      throw new XMLHttpRequest.InvalidStateError('send() already called');\n    }\n\n    switch (this._url.protocol) {\n      case 'file:':\n        return this._sendFile(data);\n\n      case 'http:':\n      case 'https:':\n        return this._sendHttp(data);\n\n      default:\n        throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n    }\n  };\n\n  XMLHttpRequest.prototype.abort = function () {\n    if (this._request == null) {\n      return;\n    }\n\n    this._request.abort();\n\n    this._setError();\n\n    this._dispatchProgress('abort');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype.getResponseHeader = function (name) {\n    if (this._responseHeaders == null || name == null) {\n      return null;\n    }\n\n    var loweredName = name.toLowerCase();\n    return this._responseHeaders.hasOwnProperty(loweredName) ? this._responseHeaders[name.toLowerCase()] : null;\n  };\n\n  XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n    var _this = this;\n\n    if (this._responseHeaders == null) {\n      return '';\n    }\n\n    return Object.keys(this._responseHeaders).map(function (key) {\n      return key + \": \" + _this._responseHeaders[key];\n    }).join('\\r\\n');\n  };\n\n  XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n    if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n      throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n    }\n\n    this._mimeOverride = mimeType.toLowerCase();\n  };\n\n  XMLHttpRequest.prototype.nodejsSet = function (options) {\n    this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n    this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n\n    if (options.hasOwnProperty('baseUrl')) {\n      if (options.baseUrl != null) {\n        var parsedUrl = url.parse(options.baseUrl, false, true);\n\n        if (!parsedUrl.protocol) {\n          throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n        }\n      }\n\n      this.nodejsBaseUrl = options.baseUrl;\n    }\n  };\n\n  XMLHttpRequest.nodejsSet = function (options) {\n    XMLHttpRequest.prototype.nodejsSet(options);\n  };\n\n  XMLHttpRequest.prototype._setReadyState = function (readyState) {\n    this.readyState = readyState;\n    this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n  };\n\n  XMLHttpRequest.prototype._sendFile = function (data) {\n    // TODO\n    throw new Error('Protocol file: not implemented');\n  };\n\n  XMLHttpRequest.prototype._sendHttp = function (data) {\n    if (this._sync) {\n      throw new Error('Synchronous XHR processing not implemented');\n    }\n\n    if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n      console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n      data = null;\n    } else {\n      data = data || '';\n    }\n\n    this.upload._setData(data);\n\n    this._finalizeHeaders();\n\n    this._sendHxxpRequest();\n  };\n\n  XMLHttpRequest.prototype._sendHxxpRequest = function () {\n    var _this = this;\n\n    if (this.withCredentials) {\n      var cookie = XMLHttpRequest.cookieJar.getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n      this._headers.cookie = this._headers.cookie2 = cookie;\n    }\n\n    var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent],\n        hxxp = _a[0],\n        agent = _a[1];\n\n    var requestMethod = hxxp.request.bind(hxxp);\n    var request = requestMethod({\n      hostname: this._url.hostname,\n      port: +this._url.port,\n      path: this._url.path,\n      auth: this._url.auth,\n      method: this._method,\n      headers: this._headers,\n      agent: agent\n    });\n    this._request = request;\n\n    if (this.timeout) {\n      request.setTimeout(this.timeout, function () {\n        return _this._onHttpTimeout(request);\n      });\n    }\n\n    request.on('response', function (response) {\n      return _this._onHttpResponse(request, response);\n    });\n    request.on('error', function (error) {\n      return _this._onHttpRequestError(request, error);\n    });\n\n    this.upload._startUpload(request);\n\n    if (this._request === request) {\n      this._dispatchProgress('loadstart');\n    }\n  };\n\n  XMLHttpRequest.prototype._finalizeHeaders = function () {\n    this._headers = __assign({}, this._headers, {\n      Connection: 'keep-alive',\n      Host: this._url.host,\n      'User-Agent': this._userAgent\n    }, this._anonymous ? {\n      Referer: 'about:blank'\n    } : {});\n\n    this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n  };\n\n  XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n    var _this = this;\n\n    if (this._request !== request) {\n      return;\n    }\n\n    if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n      XMLHttpRequest.cookieJar.setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n    }\n\n    if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n      this._url = this._parseUrl(response.headers.location);\n      this._method = 'GET';\n\n      if (this._loweredHeaders['content-type']) {\n        delete this._headers[this._loweredHeaders['content-type']];\n        delete this._loweredHeaders['content-type'];\n      }\n\n      if (this._headers['Content-Type'] != null) {\n        delete this._headers['Content-Type'];\n      }\n\n      delete this._headers['Content-Length'];\n\n      this.upload._reset();\n\n      this._finalizeHeaders();\n\n      this._sendHxxpRequest();\n\n      return;\n    }\n\n    this._response = response;\n\n    this._response.on('data', function (data) {\n      return _this._onHttpResponseData(response, data);\n    });\n\n    this._response.on('end', function () {\n      return _this._onHttpResponseEnd(response);\n    });\n\n    this._response.on('close', function () {\n      return _this._onHttpResponseClose(response);\n    });\n\n    this.responseUrl = this._url.href.split('#')[0];\n    this.status = response.statusCode;\n    this.statusText = http.STATUS_CODES[this.status];\n\n    this._parseResponseHeaders(response);\n\n    var lengthString = this._responseHeaders['content-length'] || '';\n    this._totalBytes = +lengthString;\n    this._lengthComputable = !!lengthString;\n\n    this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n    if (this._response !== response) {\n      return;\n    }\n\n    this._responseParts.push(new Buffer(data));\n\n    this._loadedBytes += data.length;\n\n    if (this.readyState !== XMLHttpRequest.LOADING) {\n      this._setReadyState(XMLHttpRequest.LOADING);\n    }\n\n    this._dispatchProgress('progress');\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n\n    this._parseResponse();\n\n    this._request = null;\n    this._response = null;\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('load');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n    if (this._response !== response) {\n      return;\n    }\n\n    var request = this._request;\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('error');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n    if (this._request !== request) {\n      return;\n    }\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('timeout');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n    if (this._request !== request) {\n      return;\n    }\n\n    this._setError();\n\n    request.abort();\n\n    this._setReadyState(XMLHttpRequest.DONE);\n\n    this._dispatchProgress('error');\n\n    this._dispatchProgress('loadend');\n  };\n\n  XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n    var event = new XMLHttpRequest.ProgressEvent(eventType);\n    event.lengthComputable = this._lengthComputable;\n    event.loaded = this._loadedBytes;\n    event.total = this._totalBytes;\n    this.dispatchEvent(event);\n  };\n\n  XMLHttpRequest.prototype._setError = function () {\n    this._request = null;\n    this._response = null;\n    this._responseHeaders = null;\n    this._responseParts = null;\n  };\n\n  XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n    var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n    var xhrUrl = url.parse(absoluteUrl, false, true);\n    xhrUrl.hash = null;\n\n    var _a = (xhrUrl.auth || '').split(':'),\n        xhrUser = _a[0],\n        xhrPassword = _a[1];\n\n    if (xhrUser || xhrPassword || user || password) {\n      xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n    }\n\n    return xhrUrl;\n  };\n\n  XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n    this._responseHeaders = {};\n\n    for (var name_1 in response.headers) {\n      var loweredName = name_1.toLowerCase();\n\n      if (this._privateHeaders[loweredName]) {\n        continue;\n      }\n\n      this._responseHeaders[loweredName] = response.headers[name_1];\n    }\n\n    if (this._mimeOverride != null) {\n      this._responseHeaders['content-type'] = this._mimeOverride;\n    }\n  };\n\n  XMLHttpRequest.prototype._parseResponse = function () {\n    var buffer = Buffer.concat(this._responseParts);\n    this._responseParts = null;\n\n    switch (this.responseType) {\n      case 'json':\n        this.responseText = null;\n\n        try {\n          this.response = JSON.parse(buffer.toString('utf-8'));\n        } catch (_a) {\n          this.response = null;\n        }\n\n        return;\n\n      case 'buffer':\n        this.responseText = null;\n        this.response = buffer;\n        return;\n\n      case 'arraybuffer':\n        this.responseText = null;\n        var arrayBuffer = new ArrayBuffer(buffer.length);\n        var view = new Uint8Array(arrayBuffer);\n\n        for (var i = 0; i < buffer.length; i++) {\n          view[i] = buffer[i];\n        }\n\n        this.response = arrayBuffer;\n        return;\n\n      case 'text':\n      default:\n        try {\n          this.responseText = buffer.toString(this._parseResponseEncoding());\n        } catch (_b) {\n          this.responseText = buffer.toString('binary');\n        }\n\n        this.response = this.responseText;\n    }\n  };\n\n  XMLHttpRequest.prototype._parseResponseEncoding = function () {\n    return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n  };\n\n  XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n  XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n  XMLHttpRequest.NetworkError = errors_1.NetworkError;\n  XMLHttpRequest.SecurityError = errors_1.SecurityError;\n  XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n  XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n  XMLHttpRequest.UNSENT = 0;\n  XMLHttpRequest.OPENED = 1;\n  XMLHttpRequest.HEADERS_RECEIVED = 2;\n  XMLHttpRequest.LOADING = 3;\n  XMLHttpRequest.DONE = 4;\n  XMLHttpRequest.cookieJar = Cookie.CookieJar();\n  return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget);\n\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;","map":{"version":3,"sources":["../xml-http-request.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar os = require(\"os\");\nvar url = require(\"url\");\nvar progress_event_1 = require(\"./progress-event\");\nvar errors_1 = require(\"./errors\");\nvar xml_http_request_event_target_1 = require(\"./xml-http-request-event-target\");\nvar xml_http_request_upload_1 = require(\"./xml-http-request-upload\");\nvar Cookie = require(\"cookiejar\");\nvar XMLHttpRequest = /** @class */ (function (_super) {\n    __extends(XMLHttpRequest, _super);\n    function XMLHttpRequest(options) {\n        if (options === void 0) { options = {}; }\n        var _this = _super.call(this) || this;\n        _this.UNSENT = XMLHttpRequest.UNSENT;\n        _this.OPENED = XMLHttpRequest.OPENED;\n        _this.HEADERS_RECEIVED = XMLHttpRequest.HEADERS_RECEIVED;\n        _this.LOADING = XMLHttpRequest.LOADING;\n        _this.DONE = XMLHttpRequest.DONE;\n        _this.onreadystatechange = null;\n        _this.readyState = XMLHttpRequest.UNSENT;\n        _this.response = null;\n        _this.responseText = '';\n        _this.responseType = '';\n        _this.status = 0; // TODO: UNSENT?\n        _this.statusText = '';\n        _this.timeout = 0;\n        _this.upload = new xml_http_request_upload_1.XMLHttpRequestUpload();\n        _this.responseUrl = '';\n        _this.withCredentials = false;\n        _this._method = null;\n        _this._url = null;\n        _this._sync = false;\n        _this._headers = {};\n        _this._loweredHeaders = {};\n        _this._mimeOverride = null; // TODO: is type right?\n        _this._request = null;\n        _this._response = null;\n        _this._responseParts = null;\n        _this._responseHeaders = null;\n        _this._aborting = null; // TODO: type?\n        _this._error = null; // TODO: type?\n        _this._loadedBytes = 0;\n        _this._totalBytes = 0;\n        _this._lengthComputable = false;\n        _this._restrictedMethods = { CONNECT: true, TRACE: true, TRACK: true };\n        _this._restrictedHeaders = {\n            'accept-charset': true,\n            'accept-encoding': true,\n            'access-control-request-headers': true,\n            'access-control-request-method': true,\n            connection: true,\n            'content-length': true,\n            cookie: true,\n            cookie2: true,\n            date: true,\n            dnt: true,\n            expect: true,\n            host: true,\n            'keep-alive': true,\n            origin: true,\n            referer: true,\n            te: true,\n            trailer: true,\n            'transfer-encoding': true,\n            upgrade: true,\n            'user-agent': true,\n            via: true\n        };\n        _this._privateHeaders = { 'set-cookie': true, 'set-cookie2': true };\n        _this._userAgent = \"Mozilla/5.0 (\" + os.type() + \" \" + os.arch() + \") node.js/\" + process.versions.node + \" v8/\" + process.versions.v8;\n        _this._anonymous = options.anon || false;\n        return _this;\n    }\n    XMLHttpRequest.prototype.open = function (method, url, async, user, password) {\n        if (async === void 0) { async = true; }\n        method = method.toUpperCase();\n        if (this._restrictedMethods[method]) {\n            throw new XMLHttpRequest.SecurityError(\"HTTP method \" + method + \" is not allowed in XHR\");\n        }\n        ;\n        var xhrUrl = this._parseUrl(url, user, password);\n        if (this.readyState === XMLHttpRequest.HEADERS_RECEIVED || this.readyState === XMLHttpRequest.LOADING) {\n            // TODO(pwnall): terminate abort(), terminate send()\n        }\n        this._method = method;\n        this._url = xhrUrl;\n        this._sync = !async;\n        this._headers = {};\n        this._loweredHeaders = {};\n        this._mimeOverride = null;\n        this._setReadyState(XMLHttpRequest.OPENED);\n        this._request = null;\n        this._response = null;\n        this.status = 0;\n        this.statusText = '';\n        this._responseParts = [];\n        this._responseHeaders = null;\n        this._loadedBytes = 0;\n        this._totalBytes = 0;\n        this._lengthComputable = false;\n    };\n    XMLHttpRequest.prototype.setRequestHeader = function (name, value) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        var loweredName = name.toLowerCase();\n        if (this._restrictedHeaders[loweredName] || /^sec-/.test(loweredName) || /^proxy-/.test(loweredName)) {\n            console.warn(\"Refused to set unsafe header \\\"\" + name + \"\\\"\");\n            return;\n        }\n        value = value.toString();\n        if (this._loweredHeaders[loweredName] != null) {\n            name = this._loweredHeaders[loweredName];\n            this._headers[name] = this._headers[name] + \", \" + value;\n        }\n        else {\n            this._loweredHeaders[loweredName] = name;\n            this._headers[name] = value;\n        }\n    };\n    XMLHttpRequest.prototype.send = function (data) {\n        if (this.readyState !== XMLHttpRequest.OPENED) {\n            throw new XMLHttpRequest.InvalidStateError('XHR readyState must be OPENED');\n        }\n        if (this._request) {\n            throw new XMLHttpRequest.InvalidStateError('send() already called');\n        }\n        switch (this._url.protocol) {\n            case 'file:':\n                return this._sendFile(data);\n            case 'http:':\n            case 'https:':\n                return this._sendHttp(data);\n            default:\n                throw new XMLHttpRequest.NetworkError(\"Unsupported protocol \" + this._url.protocol);\n        }\n    };\n    XMLHttpRequest.prototype.abort = function () {\n        if (this._request == null) {\n            return;\n        }\n        this._request.abort();\n        this._setError();\n        this._dispatchProgress('abort');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype.getResponseHeader = function (name) {\n        if (this._responseHeaders == null || name == null) {\n            return null;\n        }\n        var loweredName = name.toLowerCase();\n        return this._responseHeaders.hasOwnProperty(loweredName)\n            ? this._responseHeaders[name.toLowerCase()]\n            : null;\n    };\n    XMLHttpRequest.prototype.getAllResponseHeaders = function () {\n        var _this = this;\n        if (this._responseHeaders == null) {\n            return '';\n        }\n        return Object.keys(this._responseHeaders).map(function (key) { return key + \": \" + _this._responseHeaders[key]; }).join('\\r\\n');\n    };\n    XMLHttpRequest.prototype.overrideMimeType = function (mimeType) {\n        if (this.readyState === XMLHttpRequest.LOADING || this.readyState === XMLHttpRequest.DONE) {\n            throw new XMLHttpRequest.InvalidStateError('overrideMimeType() not allowed in LOADING or DONE');\n        }\n        this._mimeOverride = mimeType.toLowerCase();\n    };\n    XMLHttpRequest.prototype.nodejsSet = function (options) {\n        this.nodejsHttpAgent = options.httpAgent || this.nodejsHttpAgent;\n        this.nodejsHttpsAgent = options.httpsAgent || this.nodejsHttpsAgent;\n        if (options.hasOwnProperty('baseUrl')) {\n            if (options.baseUrl != null) {\n                var parsedUrl = url.parse(options.baseUrl, false, true);\n                if (!parsedUrl.protocol) {\n                    throw new XMLHttpRequest.SyntaxError(\"baseUrl must be an absolute URL\");\n                }\n            }\n            this.nodejsBaseUrl = options.baseUrl;\n        }\n    };\n    XMLHttpRequest.nodejsSet = function (options) {\n        XMLHttpRequest.prototype.nodejsSet(options);\n    };\n    XMLHttpRequest.prototype._setReadyState = function (readyState) {\n        this.readyState = readyState;\n        this.dispatchEvent(new progress_event_1.ProgressEvent('readystatechange'));\n    };\n    XMLHttpRequest.prototype._sendFile = function (data) {\n        // TODO\n        throw new Error('Protocol file: not implemented');\n    };\n    XMLHttpRequest.prototype._sendHttp = function (data) {\n        if (this._sync) {\n            throw new Error('Synchronous XHR processing not implemented');\n        }\n        if (data && (this._method === 'GET' || this._method === 'HEAD')) {\n            console.warn(\"Discarding entity body for \" + this._method + \" requests\");\n            data = null;\n        }\n        else {\n            data = data || '';\n        }\n        this.upload._setData(data);\n        this._finalizeHeaders();\n        this._sendHxxpRequest();\n    };\n    XMLHttpRequest.prototype._sendHxxpRequest = function () {\n        var _this = this;\n        if (this.withCredentials) {\n            var cookie = XMLHttpRequest.cookieJar\n                .getCookies(Cookie.CookieAccessInfo(this._url.hostname, this._url.pathname, this._url.protocol === 'https:')).toValueString();\n            this._headers.cookie = this._headers.cookie2 = cookie;\n        }\n        var _a = this._url.protocol === 'http:' ? [http, this.nodejsHttpAgent] : [https, this.nodejsHttpsAgent], hxxp = _a[0], agent = _a[1];\n        var requestMethod = hxxp.request.bind(hxxp);\n        var request = requestMethod({\n            hostname: this._url.hostname,\n            port: +this._url.port,\n            path: this._url.path,\n            auth: this._url.auth,\n            method: this._method,\n            headers: this._headers,\n            agent: agent\n        });\n        this._request = request;\n        if (this.timeout) {\n            request.setTimeout(this.timeout, function () { return _this._onHttpTimeout(request); });\n        }\n        request.on('response', function (response) { return _this._onHttpResponse(request, response); });\n        request.on('error', function (error) { return _this._onHttpRequestError(request, error); });\n        this.upload._startUpload(request);\n        if (this._request === request) {\n            this._dispatchProgress('loadstart');\n        }\n    };\n    XMLHttpRequest.prototype._finalizeHeaders = function () {\n        this._headers = __assign({}, this._headers, { Connection: 'keep-alive', Host: this._url.host, 'User-Agent': this._userAgent }, this._anonymous ? { Referer: 'about:blank' } : {});\n        this.upload._finalizeHeaders(this._headers, this._loweredHeaders);\n    };\n    XMLHttpRequest.prototype._onHttpResponse = function (request, response) {\n        var _this = this;\n        if (this._request !== request) {\n            return;\n        }\n        if (this.withCredentials && (response.headers['set-cookie'] || response.headers['set-cookie2'])) {\n            XMLHttpRequest.cookieJar\n                .setCookies(response.headers['set-cookie'] || response.headers['set-cookie2']);\n        }\n        if ([301, 302, 303, 307, 308].indexOf(response.statusCode) >= 0) {\n            this._url = this._parseUrl(response.headers.location);\n            this._method = 'GET';\n            if (this._loweredHeaders['content-type']) {\n                delete this._headers[this._loweredHeaders['content-type']];\n                delete this._loweredHeaders['content-type'];\n            }\n            if (this._headers['Content-Type'] != null) {\n                delete this._headers['Content-Type'];\n            }\n            delete this._headers['Content-Length'];\n            this.upload._reset();\n            this._finalizeHeaders();\n            this._sendHxxpRequest();\n            return;\n        }\n        this._response = response;\n        this._response.on('data', function (data) { return _this._onHttpResponseData(response, data); });\n        this._response.on('end', function () { return _this._onHttpResponseEnd(response); });\n        this._response.on('close', function () { return _this._onHttpResponseClose(response); });\n        this.responseUrl = this._url.href.split('#')[0];\n        this.status = response.statusCode;\n        this.statusText = http.STATUS_CODES[this.status];\n        this._parseResponseHeaders(response);\n        var lengthString = this._responseHeaders['content-length'] || '';\n        this._totalBytes = +lengthString;\n        this._lengthComputable = !!lengthString;\n        this._setReadyState(XMLHttpRequest.HEADERS_RECEIVED);\n    };\n    XMLHttpRequest.prototype._onHttpResponseData = function (response, data) {\n        if (this._response !== response) {\n            return;\n        }\n        this._responseParts.push(new Buffer(data));\n        this._loadedBytes += data.length;\n        if (this.readyState !== XMLHttpRequest.LOADING) {\n            this._setReadyState(XMLHttpRequest.LOADING);\n        }\n        this._dispatchProgress('progress');\n    };\n    XMLHttpRequest.prototype._onHttpResponseEnd = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        this._parseResponse();\n        this._request = null;\n        this._response = null;\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('load');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpResponseClose = function (response) {\n        if (this._response !== response) {\n            return;\n        }\n        var request = this._request;\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpTimeout = function (request) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('timeout');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._onHttpRequestError = function (request, error) {\n        if (this._request !== request) {\n            return;\n        }\n        this._setError();\n        request.abort();\n        this._setReadyState(XMLHttpRequest.DONE);\n        this._dispatchProgress('error');\n        this._dispatchProgress('loadend');\n    };\n    XMLHttpRequest.prototype._dispatchProgress = function (eventType) {\n        var event = new XMLHttpRequest.ProgressEvent(eventType);\n        event.lengthComputable = this._lengthComputable;\n        event.loaded = this._loadedBytes;\n        event.total = this._totalBytes;\n        this.dispatchEvent(event);\n    };\n    XMLHttpRequest.prototype._setError = function () {\n        this._request = null;\n        this._response = null;\n        this._responseHeaders = null;\n        this._responseParts = null;\n    };\n    XMLHttpRequest.prototype._parseUrl = function (urlString, user, password) {\n        var absoluteUrl = this.nodejsBaseUrl == null ? urlString : url.resolve(this.nodejsBaseUrl, urlString);\n        var xhrUrl = url.parse(absoluteUrl, false, true);\n        xhrUrl.hash = null;\n        var _a = (xhrUrl.auth || '').split(':'), xhrUser = _a[0], xhrPassword = _a[1];\n        if (xhrUser || xhrPassword || user || password) {\n            xhrUrl.auth = (user || xhrUser || '') + \":\" + (password || xhrPassword || '');\n        }\n        return xhrUrl;\n    };\n    XMLHttpRequest.prototype._parseResponseHeaders = function (response) {\n        this._responseHeaders = {};\n        for (var name_1 in response.headers) {\n            var loweredName = name_1.toLowerCase();\n            if (this._privateHeaders[loweredName]) {\n                continue;\n            }\n            this._responseHeaders[loweredName] = response.headers[name_1];\n        }\n        if (this._mimeOverride != null) {\n            this._responseHeaders['content-type'] = this._mimeOverride;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponse = function () {\n        var buffer = Buffer.concat(this._responseParts);\n        this._responseParts = null;\n        switch (this.responseType) {\n            case 'json':\n                this.responseText = null;\n                try {\n                    this.response = JSON.parse(buffer.toString('utf-8'));\n                }\n                catch (_a) {\n                    this.response = null;\n                }\n                return;\n            case 'buffer':\n                this.responseText = null;\n                this.response = buffer;\n                return;\n            case 'arraybuffer':\n                this.responseText = null;\n                var arrayBuffer = new ArrayBuffer(buffer.length);\n                var view = new Uint8Array(arrayBuffer);\n                for (var i = 0; i < buffer.length; i++) {\n                    view[i] = buffer[i];\n                }\n                this.response = arrayBuffer;\n                return;\n            case 'text':\n            default:\n                try {\n                    this.responseText = buffer.toString(this._parseResponseEncoding());\n                }\n                catch (_b) {\n                    this.responseText = buffer.toString('binary');\n                }\n                this.response = this.responseText;\n        }\n    };\n    XMLHttpRequest.prototype._parseResponseEncoding = function () {\n        return /;\\s*charset=(.*)$/.exec(this._responseHeaders['content-type'] || '')[1] || 'utf-8';\n    };\n    XMLHttpRequest.ProgressEvent = progress_event_1.ProgressEvent;\n    XMLHttpRequest.InvalidStateError = errors_1.InvalidStateError;\n    XMLHttpRequest.NetworkError = errors_1.NetworkError;\n    XMLHttpRequest.SecurityError = errors_1.SecurityError;\n    XMLHttpRequest.SyntaxError = errors_1.SyntaxError;\n    XMLHttpRequest.XMLHttpRequestUpload = xml_http_request_upload_1.XMLHttpRequestUpload;\n    XMLHttpRequest.UNSENT = 0;\n    XMLHttpRequest.OPENED = 1;\n    XMLHttpRequest.HEADERS_RECEIVED = 2;\n    XMLHttpRequest.LOADING = 3;\n    XMLHttpRequest.DONE = 4;\n    XMLHttpRequest.cookieJar = Cookie.CookieJar();\n    return XMLHttpRequest;\n}(xml_http_request_event_target_1.XMLHttpRequestEventTarget));\nexports.XMLHttpRequest = XMLHttpRequest;\nXMLHttpRequest.prototype.nodejsHttpAgent = http.globalAgent;\nXMLHttpRequest.prototype.nodejsHttpsAgent = https.globalAgent;\nXMLHttpRequest.prototype.nodejsBaseUrl = null;\n//# sourceMappingURL=xml-http-request.js.map"]},"metadata":{},"sourceType":"script"}